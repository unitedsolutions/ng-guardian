{"version":3,"sources":["../../src/logout-processor/logout-processor.ts"],"names":[],"mappings":"AACA,OAAO,gBAAgB,MAAM,0CAA0C,CAAC;AACxE,OAAO,cAAc,MAAM,sCAAsC,CAAC;AAClE,OAAO,UAAU,MAAY,4BAA4B,CAAC;AAC1D,OAAO,EAAC,OAAO,EAAC,MAAM,cAAc,CAAC;AAErC,MAAM,CAAC,OAAO,WAAU,UAAU;IAAlC,iBAiCC;IAhCC,IAAI,IAAI,CAAC,aAAa,CAAC,KAAK,KAAK,WAAW;WACrC,IAAI,CAAC,aAAa,CAAC,KAAK,KAAK,aAAa,EAAC;QAChD,OAAO,CAAC,gBAAgB;KACzB;IACD,OAAO,IAAI,OAAO,CAAC,UAAC,OAAO,EAAE,MAAM;QACjC,IAAI,CAAC,CAAC,UAAU,CAAC,IAAI,CAAC,UAAU,CAAC,MAAM,KAAK,CAAC,CAAC,EAAE;YAC7C,UAAU,GAAG,aAAa,CAAC;SAC7B;QACD,KAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAI,CAAC,OAAO,CAAC,SAAS,EAAE,EAAC,UAAU,YAAA,EAAC,CAAC,CAAC,SAAS,CAC5D,UAAA,OAAO;YACL,IAAI,OAAO,EAAE;gBACX,KAAI,CAAC,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC;gBACzB,IAAM,gBAAgB,GAAE,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,QAAQ,CAAC;gBAC/F,IAAI,gBAAgB,KAAK,UAAU,EAAE;oBACnC,KAAI,CAAC,aAAa,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;iBAC3C;gBACD,KAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACrB,OAAO,CAAC,OAAO,CAAC,CAAC;aAClB;QACH,CAAC,EACD,UAAA,GAAG;YACD,KAAI,CAAC,aAAa,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAC7C,OAAO,MAAM,CAAC,GAAG,CAAC,CAAC;QACrB,CAAC,CACF,CAAC;QACF,KAAI,CAAC,aAAa,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACpC,KAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrB,gBAAgB,CAAC,QAAQ,CAAC,CAAC;QAC3B,cAAc,CAAC,QAAQ,CAAC,CAAC;QACzB,UAAU,CAAC,IAAI,CAAC,KAAI,EAAE,QAAQ,EAAE,OAAO,CAAC,oBAAoB,CAAC,CAAC;QAC9D,KAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;IAC1B,CAAC,CAAC,CAAC;AACL,CAAC","file":"logout-processor.js","sourceRoot":"","sourcesContent":["import * as _           from \"lodash\";\r\nimport autoLogoutSetter from '../auto-logout-setter/auto-logout-setter';\r\nimport autoLockSetter from \"../auto-lock-setter/auto-lock-setter\";\r\nimport roleSetter       from '../role-setter/role-setter';\r\nimport {configs} from '../_lib/vars';\r\n\r\nexport default function(logoutCode) {\r\n  if (this.sessionStatus.value !== 'LOGGED_IN'\r\n      && this.sessionStatus.value !== 'LOCKED_DOWN'){\r\n    return; // doing nothing\r\n  }\r\n  return new Promise((resolve, reject) => {\r\n    if ((!logoutCode) || (logoutCode.length === 0)) {\r\n       logoutCode = 'USER_LOGOUT';\r\n    }\r\n    this.http.post(this.configs.logoutUrl, {logoutCode}).subscribe(\r\n      resdata => {\r\n        if (resdata) {\r\n          this.auth = resdata.auth;\r\n          const returnLogoutCode =((resdata.auth) && (resdata.auth.code)) ? resdata.auth.code : 'LOGOUT';\r\n          if (returnLogoutCode !== logoutCode) {\r\n            this.sessionStatus.next(returnLogoutCode);\r\n          }\r\n          this.data.next(null);\r\n          resolve(resdata);\r\n        }\r\n      },\r\n      err => {\r\n        this.sessionStatus.next('LOGOUT_WITH_ERROR');\r\n        return reject(err);\r\n      }\r\n    );\r\n    this.sessionStatus.next(logoutCode);\r\n    this.data.next(null);\r\n    autoLogoutSetter('remove');\r\n    autoLockSetter('remove');\r\n    roleSetter.call(this, 'noAuth', configs.logoutRedirctEnabled);\r\n    this.http.removeToken();\r\n  });\r\n}\r\n"]}